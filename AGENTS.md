# AGENTS.md - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM-–∞–≥–µ–Ω—Ç–æ–≤

> **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è LLM-–∞–≥–µ–Ω—Ç–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å –ø—Ä–æ–µ–∫—Ç–æ–º. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ç–æ—á–µ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

## üéØ –û–±—â–∞—è —Ü–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Telegram-–±–æ—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É Higgsfield AI. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –ø—Ä–æ–º–ø—Ç—É (text-to-image)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö —Ñ–æ—Ç–æ (image-to-image)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üß† –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Ä–º–∏–Ω—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (User)
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –ø–æ `telegram_id` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏–∑ Telegram)
- –ò–º–µ–µ—Ç –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ (`credits`)
- –ú–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ (`ActionHistory`)
- –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤ (`CreditRequest`)

### –ö—Ä–µ–¥–∏—Ç—ã (Credits)
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: **10000 –∫—Ä–µ–¥–∏—Ç–æ–≤** (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `INITIAL_USER_CREDITS`)
- –°—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: **50 –∫—Ä–µ–¥–∏—Ç–æ–≤** (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `GENERATION_CREDIT_COST`)
- –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: **2500 –∫—Ä–µ–¥–∏—Ç–æ–≤** (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `CREDIT_REQUEST_AMOUNT`)

### –†–µ–∂–∏–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (Modes)
- **NanoBanana** (`MODE_NANOBANANA`): –ú–∞–∫—Å–∏–º—É–º 8 —Ñ–æ—Ç–æ, —Ä–∞–∑–Ω—ã–µ endpoints –¥–ª—è text2image –∏ image2image
- **Seedream 4.5** (`MODE_SEEDREAM`): –ú–∞–∫—Å–∏–º—É–º 14 —Ñ–æ—Ç–æ, –µ–¥–∏–Ω—ã–π endpoint –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
storage/users/{user_id}/
‚îú‚îÄ‚îÄ last_uploads/    # –§–æ—Ç–æ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
‚îú‚îÄ‚îÄ results/         # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ used/           # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–∞—Ä—Ö–∏–≤)
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User States)
- `STATE_IDLE` - –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `STATE_WAITING_PHOTO` - –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- `STATE_WAITING_ASPECT` - –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω
- `WAITING_FOR_MODE` - –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ (–¥–ª—è ConversationHandler)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP)

- **`bot/handlers.py`** - –¢–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`api/client.py`** - –¢–æ–ª—å–∫–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º API
- **`database/db_manager.py`** - –¢–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **`storage/file_manager.py`** - –¢–æ–ª—å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
- **`config/settings.py`** - –¢–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **`config/constants.py`** - –¢–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–±–µ–∑ –ª–æ–≥–∏–∫–∏)

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.json` (–Ω–µ –≤ –∫–æ–¥–µ)
- –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `config/constants.py` (–Ω–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `settings` singleton –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `logger` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –Ω–µ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully

### 4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å API

- Higgsfield API —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ: –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `task_id`
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ polling —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ `wait_for_completion()`
- –¢–∞–π–º–∞—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)

## üìä –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

```
User ‚Üí Telegram Bot ‚Üí handlers.py
                        ‚Üì
                   –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
                        ‚Üì
                   file_manager.save_photo()
                        ‚Üì
                   api_client.generate()
                        ‚Üì
                   –ü–æ–ª—É—á–µ–Ω–∏–µ task_id
                        ‚Üì
                   api_client.wait_for_completion() [polling]
                        ‚Üì
                   –ü–æ–ª—É—á–µ–Ω–∏–µ image_url
                        ‚Üì
                   –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        ‚Üì
                   file_manager.save_result_image()
                        ‚Üì
                   –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—Ñ–∞–π–ª + —Ñ–æ—Ç–æ)
                        ‚Üì
                   db_manager.update_user_credits(-50)
                        ‚Üì
                   db_manager.add_action() [–∏—Å—Ç–æ—Ä–∏—è]
```

### –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏:

```
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ‚Üí last_uploads/ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
                    ‚Üì
            –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
                    ‚Üì
            –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ last_uploads/ (–¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
                    ‚Üì
            –ù–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –Ω–æ–≤—ã–º–∏ —Ñ–æ—Ç–æ
                    ‚Üì
            –û—á–∏—Å—Ç–∫–∞ last_uploads/ ‚Üí used/ (–∞—Ä—Ö–∏–≤)
```

## üîí –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (—á—Ç–æ –Ω–µ–ª—å–∑—è –ª–æ–º–∞—Ç—å)

### 1. –ë–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ –ø–æ–∑–≤–æ–ª—è–π—Ç–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫—Ä–µ–¥–∏—Ç–∞–º–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏ (—á–µ—Ä–µ–∑ `db_manager`)

### 2. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `context.user_data` (–Ω–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –≤ `STATE_IDLE`
- –í—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–π—Ç–µ `user_data` –≤ `finally` –±–ª–æ–∫–µ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 3. –§–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ —É–¥–∞–ª—è–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é (`os.remove`)
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `file_manager.move_to_used()` –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
- –§–∞–π–ª—ã –∏–∑ `last_uploads` –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 4. API –∑–∞–ø—Ä–æ—Å—ã
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `wait_for_completion()` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `generate()` (—Ç–æ–ª—å–∫–æ `task_id`)
- –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ –æ—à–∏–±–∫–∏ API

### 5. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è (50.0, 10000.0, 8, 14)
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ `config/constants.py`
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç –æ–±–Ω–æ–≤–ª—è–π—Ç–µ `constants.py`

## ‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ—á–µ–º—É

### 1. SQLite –≤–º–µ—Å—Ç–æ PostgreSQL
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQLite –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.
**–ü–æ—á–µ–º—É**: –ü—Ä–æ–µ–∫—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, SQLite –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è MVP.
**–ö–æ–≥–¥–∞ –º–µ–Ω—è—Ç—å**: –ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∞ >1000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### 2. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: –•—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –¥–∏—Å–∫–µ.
**–ü–æ—á–µ–º—É**: –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
**–ö–æ–≥–¥–∞ –º–µ–Ω—è—Ç—å**: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π polling
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `time.sleep()` –≤ `wait_for_completion()`.
**–ü–æ—á–µ–º—É**: –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫.
**–ö–æ–≥–¥–∞ –º–µ–Ω—è—Ç—å**: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

### 4. Inline-–∫–Ω–æ–ø–∫–∏ –≤–º–µ—Å—Ç–æ Reply-–∫–Ω–æ–ø–æ–∫
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `InlineKeyboardMarkup` –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π.
**–ü–æ—á–µ–º—É**: –ù–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ –≤ —á–∞—Ç–µ, –±–æ–ª–µ–µ –≥–∏–±–∫–∏–µ.
**–ò—Å–∫–ª—é—á–µ–Ω–∏–µ**: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –æ—Å—Ç–∞–µ—Ç—Å—è `ReplyKeyboardMarkup` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.

### 5. –ï–¥–∏–Ω—ã–π —Ñ–∞–π–ª handlers.py (1067 —Å—Ç—Ä–æ–∫)
**–†–µ—à–µ–Ω–∏–µ**: –•—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ.
**–ü–æ—á–µ–º—É**: –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
**–ö–æ–≥–¥–∞ –º–µ–Ω—è—Ç—å**: –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ >10 –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–ª–∏ –ø—Ä–∏ >2000 —Å—Ç—Ä–æ–∫.

## üõ°Ô∏è –ì–¥–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã:

1. **`config/constants.py`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç (—Å—Ç–æ–∏–º–æ—Å—Ç—å, –ª–∏–º–∏—Ç—ã)
2. **`bot/keyboards.py`** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
3. **`admin/templates/`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ HTML —à–∞–±–ª–æ–Ω–æ–≤ –∞–¥–º–∏–Ω–∫–∏
4. **`admin/routes.py`** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–Ω–µ –∏–∑–º–µ–Ω—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
5. **`utils/logger.py`** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
6. **`tests/`** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏:

1. **`bot/handlers.py`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å flow)
2. **`api/client.py`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
3. **`database/db_manager.py`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **`storage/file_manager.py`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
5. **`config/settings.py`** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üö´ –ì–¥–µ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã:

1. **–õ–æ–≥–∏–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤** (`db_manager.update_user_credits()`)
   - –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`context.user_data`)
   - –ù–∞—Ä—É—à–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é –±–æ—Ç–∞
   - –í—Å–µ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `finally` –±–ª–æ–∫–µ

3. **Polling –º–µ—Ö–∞–Ω–∏–∑–º** (`api_client.wait_for_completion()`)
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏** (`file_manager.move_to_used()`)
   - –ü—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `file_manager`

5. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤ API** (–ø–∞—Ä—Å–∏–Ω–≥ `image_url` –∏–∑ –æ—Ç–≤–µ—Ç–∞)
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º

## üîß –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

1. **–î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã** –≤ `config/constants.py`:
   ```python
   MODE_NEW_MODE = "new_mode"
   MODE_NAME_NEW_MODE = "üé® New Mode"
   MAX_PHOTOS_NEW_MODE = 10
   MODE_MAX_PHOTOS[MODE_NEW_MODE] = MAX_PHOTOS_NEW_MODE
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ API –∫–ª–∏–µ–Ω—Ç** –≤ `api/client.py`:
   ```python
   class NewModeAPIClient:
       def __init__(self):
           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
       
       def generate(self, prompt, image_paths=None, aspect_ratio="4:3"):
           # –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
       
       def get_request_status(self, request_id):
           # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
       
       def wait_for_completion(self, request_id, max_wait_time=None, poll_interval=5):
           # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–æ–∂–Ω–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞)
   ```

3. **–û–±–Ω–æ–≤–∏—Ç–µ `get_api_client()`**:
   ```python
   def get_api_client(route: str):
       if route == MODE_NEW_MODE:
           return get_new_mode_client()
       # ...
   ```

4. **–î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∂–∏–º –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É** (`bot/keyboards.py`):
   ```python
   def get_mode_selection_keyboard():
       keyboard = [
           [KeyboardButton("üçå NANOBANANA"), KeyboardButton("üé® Seedream 4.5")],
           [KeyboardButton("üé® New Mode")],  # –ù–æ–≤—ã–π —Ä–µ–∂–∏–º
           [KeyboardButton("–û—Ç–º–µ–Ω–∞")]
       ]
   ```

5. **–û–±–Ω–æ–≤–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** (`bot/handlers.py`):
   - –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤ `handle_mode_selection()`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `get_max_photos_for_mode()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫** –≤ `bot/handlers.py`:
   ```python
   async def new_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
       """–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã."""
       user = db_manager.get_or_create_user(update.effective_user.id, update.effective_user.username)
       await update.message.reply_text("–û—Ç–≤–µ—Ç –∫–æ–º–∞–Ω–¥—ã", reply_markup=get_main_keyboard())
   ```

2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** –≤ `bot/bot.py`:
   ```python
   self.application.add_handler(CommandHandler("new_command", new_command))
   ```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ –∞–¥–º–∏–Ω–∫–∏:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫** –≤ `admin/routes.py`:
   ```python
   @admin_bp.route('/new_route')
   @login_required
   def new_route():
       """–û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞."""
       return render_template('new_template.html')
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ HTML —à–∞–±–ª–æ–Ω** –≤ `admin/templates/new_template.html`

## ‚ö†Ô∏è –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º

### 1. –ó–∞–±—ã–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
**–°–∏–º–ø—Ç–æ–º**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `user.credits >= GENERATION_CREDIT_COST` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π

### 2. –ù–µ –æ—á–∏—Å—Ç–∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
**–°–∏–º–ø—Ç–æ–º**: –ë–æ—Ç "–∑–∞–≤–∏—Å–∞–µ—Ç" –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `finally` –±–ª–æ–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```python
try:
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
except Exception as e:
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
finally:
    context.user_data['state'] = STATE_IDLE
```

### 3. –ü—ã—Ç–∞–µ—Ç–µ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ generate()
**–°–∏–º–ø—Ç–æ–º**: `image_url` –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å—Ç–∞—Ç—É—Å "queued"
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `wait_for_completion()`:
```python
result = api_client.generate(...)
request_id = extract_request_id(result)
final_result = api_client.wait_for_completion(request_id)
image_url = extract_image_url(final_result)
```

### 4. –£–¥–∞–ª—è–µ—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ os.remove()
**–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–æ—Ç–æ
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `file_manager.move_to_used()`:
```python
# ‚ùå –ü–ª–æ—Ö–æ
os.remove(file_path)

# ‚úÖ –•–æ—Ä–æ—à–æ
file_manager.move_to_used(user_id, [file_path])
```

### 5. –•–∞—Ä–¥–∫–æ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
**–°–∏–º–ø—Ç–æ–º**: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
```python
# ‚ùå –ü–ª–æ—Ö–æ
if user.credits < 50.0:

# ‚úÖ –•–æ—Ä–æ—à–æ
if user.credits < GENERATION_CREDIT_COST:
```

### 6. –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã API
**–°–∏–º–ø—Ç–æ–º**: –ë–æ—Ç –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ –¥–æ–ª–≥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ `TimeoutError`:
```python
try:
    result = api_client.wait_for_completion(request_id)
except TimeoutError:
    await update.message.reply_text("‚è±Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è")
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: `bot/handlers.py::handle_aspect_ratio_callback()` (—Å—Ç—Ä–æ–∫–∞ ~790)
- **–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: `api/client.py::wait_for_completion()` (—Å—Ç—Ä–æ–∫–∞ ~265)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞–º–∏**: `database/db_manager.py::update_user_credits()` (—Å—Ç—Ä–æ–∫–∞ ~99)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏**: `storage/file_manager.py::move_to_last_uploads()` (—Å—Ç—Ä–æ–∫–∞ ~150)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞**: `bot/handlers.py::handle_prompt()` (—Å—Ç—Ä–æ–∫–∞ ~88)

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:

- **User**: `database/models.py::User` (—Å—Ç—Ä–æ–∫–∞ ~13)
- **ActionHistory**: `database/models.py::ActionHistory` (—Å—Ç—Ä–æ–∫–∞ ~31)
- **CreditRequest**: `database/models.py::CreditRequest` (—Å—Ç—Ä–æ–∫–∞ ~63)

## üéì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è LLM-–∞–≥–µ–Ω—Ç–æ–≤

1. **–í—Å–µ–≥–¥–∞ —á–∏—Ç–∞–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã** –∏–∑ `config/constants.py` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±–∞–ª–∞–Ω—Å** –ø–µ—Ä–µ–¥ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π, —Ç—Ä–µ–±—É—é—â–µ–π –∫—Ä–µ–¥–∏—Ç–æ–≤
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `file_manager`** –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
4. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
5. **–°–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –≤ `finally` –±–ª–æ–∫–µ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π
6. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `wait_for_completion()`** –¥–ª—è –≤—Å–µ—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
7. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** —á–µ—Ä–µ–∑ `logger` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2024
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0
